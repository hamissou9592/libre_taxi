{"version":3,"sources":["queue-test.js"],"names":["args","myQueue","create","sinon","stub","returns","removeOnComplete","save","queue","type","foo1","t","truthy","calledWith","assert","callOrder","delay","createDelayed","foo2","process","foo3"],"mappings":"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","file":"queue-test.js","sourcesContent":["/*\n    LibreTaxi, free and open source ride sharing platform.\n    Copyright (C) 2016-2017  Roman Pushkin\n\n    This program is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Affero General Public License as\n    published by the Free Software Foundation, either version 3 of the\n    License, or (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Affero General Public License for more details.\n\n    You should have received a copy of the GNU Affero General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n*/\n\n/* eslint-disable no-new */\n// failing test(s)? possible reason - we override queue, but these tests can run in parallel.\nimport test from 'ava';\nimport Queue from '../../src/queue/queue';\nimport { ss } from '../spec-support';\nimport sinon from 'sinon';\nimport checkNotNullTest from '../helpers/check-not-null.js';\n\ncheckNotNullTest('type', (args) => { new Queue(args); });\n\ntest('should create message on create', t => {\n  // arrange\n  const myQueue = {};\n  const create = ss.sinon.stub().returns(myQueue);\n  const removeOnComplete = ss.sinon.stub().returns(myQueue);\n  const save = ss.sinon.stub().returns(myQueue);\n  Object.assign(myQueue, { create, removeOnComplete, save });\n  const queue = new Queue({ type: 'test-queue-type1', queue: myQueue });\n\n  // act\n  queue.create({ foo1: 'bar1' });\n\n  // assert\n  t.truthy(create.calledWith('test-queue-type1', { foo1: 'bar1' }));\n  t.truthy(removeOnComplete.calledWith(true));\n  t.truthy(save.calledWith());\n  sinon.assert.callOrder(create, removeOnComplete, save);\n});\n\ntest('should create delayed message on createDelayed', t => {\n  // arrange\n  const myQueue = {};\n  const create = ss.sinon.stub().returns(myQueue);\n  const delay = ss.sinon.stub().returns(myQueue);\n  const removeOnComplete = ss.sinon.stub().returns(myQueue);\n  const save = ss.sinon.stub().returns(myQueue);\n  Object.assign(myQueue, { create, delay, removeOnComplete, save });\n  const queue = new Queue({ type: 'test-queue-type2', queue: myQueue });\n\n  // act\n  queue.createDelayed({ foo2: 'bar2' });\n\n  // assert\n  t.truthy(create.calledWith('test-queue-type2', { foo2: 'bar2' }));\n  t.truthy(delay.calledWith(1000));\n  t.truthy(removeOnComplete.calledWith(true));\n  t.truthy(save.calledWith());\n  sinon.assert.callOrder(create, delay, removeOnComplete, save);\n});\n\ntest('should process \\'call-action\\' messages', t => {\n  // arrange\n  const myQueue = { process: ss.sinon.stub() };\n  const queue = new Queue({ type: 'test-queue-type3', queue: myQueue });\n\n  // act\n  queue.process({ foo3: 'bar3' });\n\n  // assert\n  t.truthy(myQueue.process.calledWith('test-queue-type3', 20, { foo3: 'bar3' }));\n});\n\ntest('should create delayed message with custom delay on createDelayed', t => {\n  // arrange\n  const myQueue = {};\n  const create = ss.sinon.stub().returns(myQueue);\n  const delay = ss.sinon.stub().returns(myQueue);\n  const removeOnComplete = ss.sinon.stub().returns(myQueue);\n  const save = ss.sinon.stub().returns(myQueue);\n  Object.assign(myQueue, { create, delay, removeOnComplete, save });\n  const queue = new Queue({ type: 'test-queue-type2', queue: myQueue });\n\n  // act\n  queue.createDelayed({ foo2: 'bar2' }, 31337);\n\n  // assert\n  t.truthy(create.calledWith('test-queue-type2', { foo2: 'bar2' }));\n  t.truthy(delay.calledWith(31337));\n  t.truthy(removeOnComplete.calledWith(true));\n  t.truthy(save.calledWith());\n  sinon.assert.callOrder(create, delay, removeOnComplete, save);\n});\n"]}