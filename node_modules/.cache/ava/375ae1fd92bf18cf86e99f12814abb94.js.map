{"version":3,"sources":["inline-options-response-handler-test.js"],"names":["args","responseObject","rows","label","value","response","t","pass","cb","plan","user","platformId","h","api","sendMessage","sinon","stub","returns","catch","call","truthy","calledWith","disable_notification","reply_markup","stringify","inline_keyboard","text","callback_data","end","defaultMessage"],"mappings":"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","file":"inline-options-response-handler-test.js","sourcesContent":["/*\n    LibreTaxi, free and open source ride sharing platform.\n    Copyright (C) 2016-2017  Roman Pushkin\n\n    This program is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Affero General Public License as\n    published by the Free Software Foundation, either version 3 of the\n    License, or (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Affero General Public License for more details.\n\n    You should have received a copy of the GNU Affero General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n*/\n\n/* eslint-disable no-new, max-len */\nimport test from 'ava';\nimport InlineOptionsResponseHandler from '../../../src/response-handlers/telegram/inline-options-response-handler';\nimport InlineOptionsResponse from '../../../src/responses/options-response';\nimport checkNotNullTest from '../../helpers/check-not-null.js';\nimport { ss } from '../../spec-support';\n\ncheckNotNullTest('response', (args) => { new InlineOptionsResponseHandler(args); });\n\nconst responseObject = new InlineOptionsResponse({\n  rows: [\n    [{ label: 'One', value: '1' }, { label: 'Two', value: '2' }, { label: 'Three', value: '3' }],\n    [{ label: 'OK', value: 'ok' }, { label: 'Cancel', value: 'cancel' }],\n  ],\n});\n\ntest('can be constructed with default parameters', t => {\n  new InlineOptionsResponseHandler({ response: {} });\n  t.pass();\n});\n\ntest.cb('should call sendMessage', t => {\n  t.plan(1);\n  const user = { platformId: 31337 };\n  const h = new InlineOptionsResponseHandler({ response: responseObject, user });\n  h.api = { sendMessage: ss.sinon.stub().returns({ catch: () => {} }) };\n  h.call(() => { // should call onResult\n    t.truthy(h.api.sendMessage.calledWith(31337, 'Your choice?', {\n      disable_notification: true,\n      reply_markup:\n        JSON.stringify({\n          inline_keyboard: [\n            [\n              { text: 'One', callback_data: '1' },\n              { text: 'Two', callback_data: '2' },\n              { text: 'Three', callback_data: '3' },\n            ],\n            [\n              { text: 'OK', callback_data: 'ok' },\n              { text: 'Cancel', callback_data: 'cancel' },\n            ],\n          ],\n        }),\n    }));\n    t.end();\n  });\n});\n\ntest.cb('should call sendMessage with default message', t => {\n  t.plan(1);\n  const user = { platformId: 31337 };\n  const h = new InlineOptionsResponseHandler({\n    response: new InlineOptionsResponse({ rows: responseObject.rows, defaultMessage: 'foo' }),\n    user,\n  });\n  h.api = { sendMessage: ss.sinon.stub().returns({ catch: () => {} }) };\n  h.call(() => { // should call onResult\n    t.truthy(h.api.sendMessage.calledWith(31337, 'foo', {\n      disable_notification: true,\n      reply_markup:\n        JSON.stringify({\n          inline_keyboard: [\n            [\n              { text: 'One', callback_data: '1' },\n              { text: 'Two', callback_data: '2' },\n              { text: 'Three', callback_data: '3' },\n            ],\n            [\n              { text: 'OK', callback_data: 'ok' },\n              { text: 'Cancel', callback_data: 'cancel' },\n            ],\n          ],\n        }),\n    }));\n    t.end();\n  });\n});\n"]}