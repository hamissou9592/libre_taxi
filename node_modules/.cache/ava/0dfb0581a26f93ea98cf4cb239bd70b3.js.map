{"version":3,"sources":["parsed-location-test.js"],"names":["defaultParams","type","i18n","user","origin","action","t","pass","get","sinon","spy","post","truthy","calledWith","falsy","gt","call","data","foo","undefined","plan","length","p","item","r","is","responses","deepEqual","location"],"mappings":"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","file":"parsed-location-test.js","sourcesContent":["/*\n    LibreTaxi, free and open source ride sharing platform.\n    Copyright (C) 2016-2017  Roman Pushkin\n\n    This program is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Affero General Public License as\n    published by the Free Software Foundation, either version 3 of the\n    License, or (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Affero General Public License for more details.\n\n    You should have received a copy of the GNU Affero General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n*/\n\n/* eslint-disable no-new, no-unused-vars */\nimport test from 'ava';\nimport routes from '../../../src/routes'; // to aviod circular dependencies\nimport ParsedLocation from '../../../src/actions/decorators/parsed-location';\nimport { ss } from '../../spec-support';\n\nconst defaultParams = { type: 'foo', i18n: {}, user: {} };\n\ntest('can be constructed with default parameters', t => {\n  const origin = {};\n  const action = new ParsedLocation(defaultParams, origin);\n  t.pass();\n});\n\ntest('should just call origin on get', t => {\n  const origin = {\n    get: ss.sinon.spy(),\n    post: ss.sinon.spy(),\n  };\n  const action = new ParsedLocation(defaultParams, origin);\n  action.get();\n  t.truthy(origin.get.calledWith());\n  t.falsy(origin.post.calledWith());\n});\n\ntest('should just call origin on t, gt with parameters', t => {\n  const origin = {\n    t: ss.sinon.spy(),\n    gt: ss.sinon.spy(),\n  };\n  const action = new ParsedLocation(defaultParams, origin);\n  action.t(1, 2, 3);\n  action.gt(11, 22, 33);\n  t.truthy(origin.t.calledWith(1, 2, 3));\n  t.truthy(origin.gt.calledWith(11, 22, 33));\n});\n\ntest('should call \"get\" on \"call\" when no argument provided', t => {\n  const origin = {\n    get: ss.sinon.spy(),\n    post: ss.sinon.spy(),\n  };\n  const action = new ParsedLocation(defaultParams, origin);\n  action.call();\n  t.truthy(origin.get.calledWith());\n  t.falsy(origin.post.calledWith());\n});\n\ntest('should call own \"post\" on \"call\" when argument provided', t => {\n  const origin = {\n    get: ss.sinon.spy(),\n    post: ss.sinon.spy(),\n  };\n  const action = new ParsedLocation(defaultParams, origin);\n  action.post = ss.sinon.spy();\n  action.call(31337);\n  t.falsy(origin.get.calledWith());\n  t.falsy(origin.post.calledWith());\n  t.truthy(action.post.calledWith(31337));\n});\n\ntest('should call origin on post for unprocessable data', t => {\n  const data = [\n    123,\n    'asd',\n    0,\n    -123,\n    [1, 2],\n    { foo: 31337 },\n    '1234.0123, 1234.0123',\n    '123.abc, 123.abc',\n    undefined,\n    '',\n  ];\n  t.plan(data.length * 2);\n\n  for (const p of data) {\n    const origin = {\n      get: ss.sinon.spy(),\n      post: ss.sinon.spy(),\n    };\n    const action = new ParsedLocation(defaultParams, origin);\n    action.post(p);\n    t.falsy(origin.get.calledWith());\n    t.truthy(origin.post.calledWith(p));\n  }\n});\n\ntest('should call origin with parsed coordinates when data is processable', t => {\n  // array of items where:\n  // item[0] - actual data\n  // item[1] - expected data\n\n  const data = [\n    ['37.012345678901234,-122.012345678901234', [37.012345678901234, -122.012345678901234]],\n    ['123.123,123.123', [123.123, 123.123]],\n    ['123.123, 123.123', [123.123, 123.123]],\n    [' 123.123, 123.123 ', [123.123, 123.123]],\n    [' 123.123 , 123.123 ', [123.123, 123.123]],\n    ['37.421955, -122.084058', [37.421955, -122.084058]],\n    ['1, 2', [1, 2]],\n    ['1.123, 2', [1.123, 2]],\n    ['1, 2.123', [1, 2.123]],\n    ['1, -2', [1, -2]],\n    ['-1, 2', [-1, 2]],\n    [[37.421955, -122.084058], [37.421955, -122.084058]],\n  ];\n\n  t.plan(data.length * 2);\n\n  for (const item of data) {\n    const origin = {\n      get: ss.sinon.spy(),\n      post: ss.sinon.spy(),\n    };\n    const action = new ParsedLocation(defaultParams, origin);\n    action.post(item[0]);\n    t.falsy(origin.get.calledWith());\n    t.truthy(origin.post.calledWith(item[1]));\n  }\n});\n\ntest('should return composite object with map', t => {\n  const origin = {\n    get: ss.sinon.spy(),\n    post: ss.sinon.spy(),\n  };\n  const action = new ParsedLocation(defaultParams, origin);\n  const r = action.post('37.421955, -122.084058');\n  t.is(r.type, 'composite');\n  t.is(r.responses.length, 2);\n  t.is(r.responses[0].type, 'map');\n  t.deepEqual(r.responses[0].location, [37.421955, -122.084058]);\n});\n"]}