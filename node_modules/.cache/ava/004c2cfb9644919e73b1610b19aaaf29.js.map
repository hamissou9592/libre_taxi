{"version":3,"sources":["optimized-request-phone-test.js"],"names":["r","t","is","type","origin","origin1","origin2","add","message","origin3","rr1","responses","rr2","rr3","length","optimized","condition","ok","err"],"mappings":"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","file":"optimized-request-phone-test.js","sourcesContent":["/*\n    LibreTaxi, free and open source ride sharing platform.\n    Copyright (C) 2016-2017  Roman Pushkin\n\n    This program is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Affero General Public License as\n    published by the Free Software Foundation, either version 3 of the\n    License, or (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Affero General Public License for more details.\n\n    You should have received a copy of the GNU Affero General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n*/\n\n/* eslint-disable no-new, max-len */\nimport test from 'ava';\nimport CompositeResponse from '../../../src/responses/composite-response';\nimport OptimizedRequestPhone from '../../../src/responses/decorators/optimized-request-phone';\nimport TextResponse from '../../../src/responses/text-response';\nimport RequestPhoneResponse from '../../../src/responses/request-phone-response';\nimport IfResponse from '../../../src/responses/if-response';\n\ntest('can be constructed with default parameters', t => {\n  const r = new OptimizedRequestPhone(new CompositeResponse());\n  t.is(r.type, 'composite');\n  t.is(r.origin.type, 'composite');\n});\n\ntest('should not fail on non-optimizable responses', t => {\n  const origin1 = new CompositeResponse();\n  const origin2 = new CompositeResponse().add(new TextResponse({ message: 'foo' }));\n  const origin3 = new CompositeResponse().add(new RequestPhoneResponse());\n  const rr1 = new OptimizedRequestPhone(origin1).responses;\n  const rr2 = new OptimizedRequestPhone(origin2).responses;\n  const rr3 = new OptimizedRequestPhone(origin3).responses;\n  t.is(rr1.length, 0);\n  t.is(rr2.length, 1);\n  t.is(rr3.length, 1);\n});\n\ntest('should optimize basic response', t => {\n  const origin = new CompositeResponse()\n    .add(new TextResponse({ message: 'foo' }))\n    .add(new RequestPhoneResponse());\n  const optimized = new OptimizedRequestPhone(origin);\n  t.is(optimized.responses.length, 1);\n  t.is(optimized.responses[0].type, 'request-phone');\n  t.is(optimized.responses[0].message, 'foo');\n});\n\ntest('should optimize nested response', t => {\n  const origin = new CompositeResponse()\n    .add(new CompositeResponse()\n      .add(new TextResponse({ message: 'foo' }))\n      .add(new RequestPhoneResponse())\n    );\n  const optimized = new OptimizedRequestPhone(origin);\n  t.is(optimized.responses.length, 1);\n  t.is(optimized.responses[0].type, 'composite');\n  t.is(optimized.responses[0].responses.length, 1);\n  t.is(optimized.responses[0].responses[0].type, 'request-phone');\n  t.is(optimized.responses[0].responses[0].message, 'foo');\n});\n\ntest('should optimize nested response with if', t => {\n  const origin = new CompositeResponse()\n    .add(new CompositeResponse()\n      .add(new IfResponse({\n        condition: {},\n        ok: new CompositeResponse()\n          .add(new TextResponse({ message: 'foo' }))\n          .add(new RequestPhoneResponse()),\n        err: new CompositeResponse()\n          .add(new TextResponse({ message: 'bar' }))\n          .add(new RequestPhoneResponse()),\n      }))\n    );\n  const optimized = new OptimizedRequestPhone(origin);\n  t.is(optimized.responses.length, 1);\n  t.is(optimized.responses[0].type, 'composite');\n  t.is(optimized.responses[0].responses.length, 1);\n  t.is(optimized.responses[0].responses[0].type, 'if');\n  t.is(optimized.responses[0].responses[0].ok.type, 'composite');\n  t.is(optimized.responses[0].responses[0].ok.responses.length, 1);\n  t.is(optimized.responses[0].responses[0].ok.responses[0].type, 'request-phone');\n  t.is(optimized.responses[0].responses[0].ok.responses[0].message, 'foo');\n  t.is(optimized.responses[0].responses[0].err.type, 'composite');\n  t.is(optimized.responses[0].responses[0].err.responses.length, 1);\n  t.is(optimized.responses[0].responses[0].err.responses[0].type, 'request-phone');\n  t.is(optimized.responses[0].responses[0].err.responses[0].message, 'bar');\n});\n"]}