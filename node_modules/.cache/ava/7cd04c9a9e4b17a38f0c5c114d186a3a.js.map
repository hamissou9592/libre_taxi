{"version":3,"sources":["redirect-response-handler-test.js"],"names":["STATEFUL_CONNSTR","STATEFUL_CREDENTIALS_FILE","undefined","server","before","users","cli_2","menuLocation","after","always","close","args","response","user","t","pass","cb","plan","platformType","platformId","load","then","is","state","path","handler","call","end"],"mappings":";;weAAA;;;;;;;;;;;;;;;;;;AAkBA;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA,kCAAiB;AACfA,oBAAkB,qCADH;AAEfC,6BAA2BC;AAFZ,CAAjB;;AAKA,IAAIC,SAAS,IAAb;;AAEA,cAAKC,MAAL,CAAY,YAAM;AAChBD,WAAS,6BAAmB,IAAnB,EAAyB,2BAAzB,EAAsD;AAC7DE,WAAO;AACLC,aAAO,EAAEC,cAAc,WAAhB;AADF;AADsD,GAAtD,CAAT;AAKD,CAND;;AAQA,cAAKC,KAAL,CAAWC,MAAX,CAAkB,oBAAlB,EAAwC,YAAM;AAC5CN,SAAOO,KAAP;AACD,CAFD;;AAIA,4BAAiB,CAAC,UAAD,EAAa,MAAb,CAAjB,EAAuC,UAACC,IAAD,EAAU;AAAE,wCAA4BA,IAA5B;AAAoC,CAAvF;;AAEA,mBAAK,4CAAL,EAAmD,aAAK;AACtD,wCAA4B,EAAEC,UAAU,EAAZ,EAAgBC,MAAM,EAAtB,EAA5B;AACAC,IAAEC,IAAF;AACD,CAHD;;AAKA,cAAKC,EAAL,CAAQ,qBAAR,EAA+B,aAAK;AAClCF,IAAEG,IAAF,CAAO,CAAP;;AAEA,qBAAS,EAAEC,cAAc,KAAhB,EAAuBC,YAAY,CAAnC,EAAT,EAAiDC,IAAjD,GAAwDC,IAAxD,CAA6D,UAACR,IAAD,EAAU;AAAA;;AACrEC,MAAEQ,EAAF,uBAAK,yDAAKC,KAAL,wBAAWhB,YAAhB;AAAA;AAAA;AAAA;AAAA,QAA8B,WAA9B;;AAEA,QAAMK,WAAW,+BAAqB,EAAEY,MAAM,SAAR,EAArB,CAAjB;AACA,QAAMC,UAAU,sCAA4B,EAAEb,kBAAF,EAAYC,UAAZ,EAA5B,CAAhB;;AAEAY,YAAQC,IAAR,CAAa,YAAM;AAAA;;AACjBZ,QAAEQ,EAAF,yBAAK,2DAAKC,KAAL,wBAAWhB,YAAhB;AAAA;AAAA;AAAA;AAAA,UAA8B,SAA9B;AACAO,QAAEa,GAAF;AACD,KAHD;AAID,GAVD;AAWD,CAdD","file":"redirect-response-handler-test.js","sourcesContent":["/*\n    LibreTaxi, free and open source ride sharing platform.\n    Copyright (C) 2016-2017  Roman Pushkin\n\n    This program is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Affero General Public License as\n    published by the Free Software Foundation, either version 3 of the\n    License, or (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Affero General Public License for more details.\n\n    You should have received a copy of the GNU Affero General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n*/\n\n/* eslint-disable no-new */\nimport test from 'ava';\nimport RedirectResponseHandler from '../../src/response-handlers/redirect-response-handler';\nimport RedirectResponse from '../../src/responses/redirect-response';\nimport checkNotNullTest from '../helpers/check-not-null.js';\nimport User from '../../src/user';\nimport FirebaseServer from 'firebase-server';\nimport { overrideSettings } from '../../src/firebase-db';\n\noverrideSettings({\n  STATEFUL_CONNSTR: 'ws://localhost.firebaseio.test:5501',\n  STATEFUL_CREDENTIALS_FILE: undefined,\n});\n\nlet server = null;\n\ntest.before(() => {\n  server = new FirebaseServer(5501, 'localhost.firebaseio.test', {\n    users: {\n      cli_2: { menuLocation: 'something' },\n    },\n  });\n});\n\ntest.after.always('guaranteed cleanup', () => {\n  server.close();\n});\n\ncheckNotNullTest(['response', 'user'], (args) => { new RedirectResponseHandler(args); });\n\ntest('can be constructed with default parameters', t => {\n  new RedirectResponseHandler({ response: {}, user: {} });\n  t.pass();\n});\n\ntest.cb('updates user object', t => {\n  t.plan(2);\n\n  new User({ platformType: 'cli', platformId: 2 }).load().then((user) => {\n    t.is(user.state.menuLocation, 'something');\n\n    const response = new RedirectResponse({ path: 'default' });\n    const handler = new RedirectResponseHandler({ response, user });\n\n    handler.call(() => {\n      t.is(user.state.menuLocation, 'default');\n      t.end();\n    });\n  });\n});\n"]}