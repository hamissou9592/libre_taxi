{"version":3,"sources":["optimized-request-location-test.js"],"names":["r","t","is","type","origin","origin1","origin2","add","message","origin3","rr1","responses","rr2","rr3","length","optimized","condition","ok","err"],"mappings":"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","file":"optimized-request-location-test.js","sourcesContent":["/*\n    LibreTaxi, free and open source ride sharing platform.\n    Copyright (C) 2016-2017  Roman Pushkin\n\n    This program is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Affero General Public License as\n    published by the Free Software Foundation, either version 3 of the\n    License, or (at your option) any later version.\n\n    This program is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n    GNU Affero General Public License for more details.\n\n    You should have received a copy of the GNU Affero General Public License\n    along with this program.  If not, see <http://www.gnu.org/licenses/>.\n*/\n\n/* eslint-disable no-new, max-len */\nimport test from 'ava';\nimport CompositeResponse from '../../../src/responses/composite-response';\nimport OptimizedRequestLocation from '../../../src/responses/decorators/optimized-request-location';\nimport TextResponse from '../../../src/responses/text-response';\nimport RequestLocationResponse from '../../../src/responses/request-location-response';\nimport IfResponse from '../../../src/responses/if-response';\n\ntest('can be constructed with default parameters', t => {\n  const r = new OptimizedRequestLocation(new CompositeResponse());\n  t.is(r.type, 'composite');\n  t.is(r.origin.type, 'composite');\n});\n\ntest('should not fail on non-optimizable responses', t => {\n  const origin1 = new CompositeResponse();\n  const origin2 = new CompositeResponse().add(new TextResponse({ message: 'foo' }));\n  const origin3 = new CompositeResponse().add(new RequestLocationResponse());\n  const rr1 = new OptimizedRequestLocation(origin1).responses;\n  const rr2 = new OptimizedRequestLocation(origin2).responses;\n  const rr3 = new OptimizedRequestLocation(origin3).responses;\n  t.is(rr1.length, 0);\n  t.is(rr2.length, 1);\n  t.is(rr3.length, 1);\n});\n\ntest('should optimize basic response', t => {\n  const origin = new CompositeResponse()\n    .add(new TextResponse({ message: 'foo' }))\n    .add(new RequestLocationResponse());\n  const optimized = new OptimizedRequestLocation(origin);\n  t.is(optimized.responses.length, 1);\n  t.is(optimized.responses[0].type, 'request-location');\n  t.is(optimized.responses[0].message, 'foo');\n});\n\ntest('should optimize nested response', t => {\n  const origin = new CompositeResponse()\n    .add(new CompositeResponse()\n      .add(new TextResponse({ message: 'foo' }))\n      .add(new RequestLocationResponse())\n    );\n  const optimized = new OptimizedRequestLocation(origin);\n  t.is(optimized.responses.length, 1);\n  t.is(optimized.responses[0].type, 'composite');\n  t.is(optimized.responses[0].responses.length, 1);\n  t.is(optimized.responses[0].responses[0].type, 'request-location');\n  t.is(optimized.responses[0].responses[0].message, 'foo');\n});\n\ntest('should optimize nested response with if', t => {\n  const origin = new CompositeResponse()\n    .add(new CompositeResponse()\n      .add(new IfResponse({\n        condition: {},\n        ok: new CompositeResponse()\n          .add(new TextResponse({ message: 'foo' }))\n          .add(new RequestLocationResponse()),\n        err: new CompositeResponse()\n          .add(new TextResponse({ message: 'bar' }))\n          .add(new RequestLocationResponse()),\n      }))\n    );\n  const optimized = new OptimizedRequestLocation(origin);\n  t.is(optimized.responses.length, 1);\n  t.is(optimized.responses[0].type, 'composite');\n  t.is(optimized.responses[0].responses.length, 1);\n  t.is(optimized.responses[0].responses[0].type, 'if');\n  t.is(optimized.responses[0].responses[0].ok.type, 'composite');\n  t.is(optimized.responses[0].responses[0].ok.responses.length, 1);\n  t.is(optimized.responses[0].responses[0].ok.responses[0].type, 'request-location');\n  t.is(optimized.responses[0].responses[0].ok.responses[0].message, 'foo');\n  t.is(optimized.responses[0].responses[0].err.type, 'composite');\n  t.is(optimized.responses[0].responses[0].err.responses.length, 1);\n  t.is(optimized.responses[0].responses[0].err.responses[0].type, 'request-location');\n  t.is(optimized.responses[0].responses[0].err.responses[0].message, 'bar');\n});\n"]}